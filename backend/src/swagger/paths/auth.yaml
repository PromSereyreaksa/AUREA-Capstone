paths:
  /api/v1/users/google:
    post:
      summary: Authenticate with Google OAuth
      description: |
        Authenticates a user using Google OAuth credentials. Creates a new user if one doesn't exist,
        or links Google account to existing user with the same email, or logs in existing Google user.
        Returns a JWT token for subsequent API requests.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - google_id
                - email
              properties:
                google_id:
                  type: string
                  description: Google user ID from OAuth provider
                  example: "117234567890123456789"
                email:
                  type: string
                  format: email
                  description: User's email from Google account
                  example: user@gmail.com
                name:
                  type: string
                  description: User's full name from Google profile
                  example: John Doe
                avatar_url:
                  type: string
                  format: uri
                  description: URL to user's Google profile picture
                  example: "https://lh3.googleusercontent.com/a/default-user"
                role:
                  type: string
                  enum: [client, designer, admin]
                  description: User's role (defaults to designer for new users)
                  example: designer
            example:
              google_id: "117234567890123456789"
              email: john.doe@gmail.com
              name: John Doe
              avatar_url: "https://lh3.googleusercontent.com/a/default-user"
              role: designer
      responses:
        '200':
          description: Google authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
                        description: JWT token for authentication
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              examples:
                newUser:
                  summary: New user created via Google
                  value:
                    success: true
                    data:
                      user:
                        user_id: 5
                        email: john.doe@gmail.com
                        role: designer
                        google_id: "117234567890123456789"
                        email_verified: true
                        auth_provider: google
                        created_at: "2026-02-03T10:00:00.000Z"
                        last_login_at: "2026-02-03T10:00:00.000Z"
                      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                existingUser:
                  summary: Existing Google user logged in
                  value:
                    success: true
                    data:
                      user:
                        user_id: 3
                        email: existing@gmail.com
                        role: client
                        google_id: "117234567890123456789"
                        email_verified: true
                        auth_provider: google
                        created_at: "2026-01-15T08:30:00.000Z"
                        last_login_at: "2026-02-03T10:00:00.000Z"
                      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/users/signup:
    post:
      summary: Register a new user
      description: |
        Creates a new user account and sends an OTP to the provided email for verification.
        The OTP is valid for 10 minutes and must be used to verify the email before the user can log in.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - role
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address (must be unique)
                  example: user@example.com
                password:
                  type: string
                  format: password
                  minLength: 6
                  description: User's password (minimum 6 characters)
                  example: password123
                role:
                  type: string
                  enum: [client, designer, admin]
                  description: User's role in the system
                  example: designer
            examples:
              designer:
                summary: Designer signup
                value:
                  email: designer@example.com
                  password: securePass123
                  role: designer
              client:
                summary: Client signup
                value:
                  email: client@example.com
                  password: clientPass456
                  role: client
      responses:
        '201':
          description: User created successfully. OTP sent to email.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User created successfully
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                        example: 1
                      email:
                        type: string
                        example: user@example.com
                      otp:
                        type: string
                        description: OTP code (returned in development/testing only, not in production)
                        example: "123456"
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  message: Email already exists
                  code: DUPLICATE_EMAIL

  /api/v1/users/verify-otp:
    post:
      summary: Verify email with OTP
      description: |
        Verifies the user's email using the OTP code sent during signup.
        Returns a JWT token upon successful verification which should be used for authenticated requests.
        The token expires in 7 days by default.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: user@example.com
                otp:
                  type: string
                  pattern: '^\d{6}$'
                  description: 6-digit OTP code sent to email
                  example: "123456"
            example:
              email: user@example.com
              otp: "123456"
      responses:
        '200':
          description: Email verified successfully. JWT token returned.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: OTP verified successfully
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: Email verified successfully
                      token:
                        type: string
                        description: JWT authentication token (include in Authorization header for protected routes)
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSIsInJvbGUiOiJkZXNpZ25lciIsImlhdCI6MTczODA1MDAwMCwiZXhwIjoxNzM4NjU0ODAwfQ.abcdef123456
                      user:
                        $ref: '#/components/schemas/User'
        '400':
          description: Invalid OTP or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidOTP:
                  summary: Invalid OTP
                  value:
                    success: false
                    error:
                      message: Invalid OTP
                      code: INVALID_OTP
                expiredOTP:
                  summary: Expired OTP
                  value:
                    success: false
                    error:
                      message: OTP has expired
                      code: OTP_EXPIRED
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/users/resend-otp:
    post:
      summary: Resend OTP code
      description: |
        Generates and sends a new OTP code to the user's email.
        Cannot be used if the email is already verified.
        The new OTP will replace any previously sent OTP.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: user@example.com
            example:
              email: user@example.com
      responses:
        '200':
          description: OTP resent successfully or email already verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: OTP resent successfully
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: New OTP sent to your email
                      otp:
                        type: string
                        description: New OTP code (returned in development for testing)
                        example: "654321"
              examples:
                success:
                  summary: OTP resent successfully
                  value:
                    success: true
                    message: OTP resent successfully
                    data:
                      success: true
                      message: New OTP sent to your email
                      otp: "654321"
                alreadyVerified:
                  summary: Email already verified
                  value:
                    success: true
                    message: OTP resent successfully
                    data:
                      success: false
                      message: Email is already verified
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
