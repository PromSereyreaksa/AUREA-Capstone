paths:
  /api/v1/users/google:
    post:
      summary: Authenticate with Google OAuth
      description: |
        Authenticates a user using Google OAuth credentials. Creates a new user if one doesn't exist,
        or links Google account to existing user with the same email, or logs in existing Google user.
        Returns a JWT token for subsequent API requests.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - google_id
                - email
              properties:
                google_id:
                  type: string
                  description: Google user ID from OAuth provider
                  example: "117234567890123456789"
                email:
                  type: string
                  format: email
                  description: User's email from Google account
                  example: user@gmail.com
                name:
                  type: string
                  description: User's full name from Google profile (will be split into first/last name)
                  example: John Doe
                first_name:
                  type: string
                  description: User's first name (takes priority over name splitting)
                  example: John
                last_name:
                  type: string
                  description: User's last name (takes priority over name splitting)
                  example: Doe
                avatar_url:
                  type: string
                  format: uri
                  description: URL to user's Google profile picture
                  example: "https://lh3.googleusercontent.com/a/default-user"
            example:
              google_id: "117234567890123456789"
              email: john.doe@gmail.com
              name: John Doe
              first_name: John
              last_name: Doe
              avatar_url: "https://lh3.googleusercontent.com/a/default-user"
      responses:
        '200':
          description: Google authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
                        description: JWT token for authentication
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              examples:
                newUser:
                  summary: New user created via Google
                  value:
                    success: true
                    data:
                      user:
                        user_id: 5
                        email: john.doe@gmail.com
                        google_id: "117234567890123456789"
                        email_verified: true
                        auth_provider: google
                        created_at: "2026-02-03T10:00:00.000Z"
                        last_login_at: "2026-02-03T10:00:00.000Z"
                      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                existingUser:
                  summary: Existing Google user logged in
                  value:
                    success: true
                    data:
                      user:
                        user_id: 3
                        email: existing@gmail.com
                        google_id: "117234567890123456789"
                        email_verified: true
                        auth_provider: google
                        created_at: "2026-01-15T08:30:00.000Z"
                        last_login_at: "2026-02-03T10:00:00.000Z"
                      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/users/signup:
    post:
      summary: Register a new user
      description: |
        Creates a new user account and sends an OTP to the provided email for verification.
        The OTP is valid for 10 minutes and must be used to verify the email before the user can log in.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - first_name
                - last_name
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address (must be unique)
                  example: user@example.com
                password:
                  type: string
                  format: password
                  minLength: 6
                  description: User's password (minimum 6 characters)
                  example: password123
                first_name:
                  type: string
                  description: User's first name
                  example: John
                last_name:
                  type: string
                  description: User's last name
                  example: Doe
            examples:
              designer:
                summary: Designer signup
                value:
                  email: designer@example.com
                  password: securePass123
                  first_name: Jane
                  last_name: Designer
              client:
                summary: Client signup
                value:
                  email: client@example.com
                  password: clientPass456
                  first_name: Bob
                  last_name: Client
      responses:
        '201':
          description: User created successfully. OTP sent to email.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User created successfully
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                        example: 1
                      email:
                        type: string
                        example: user@example.com
                      otp:
                        type: string
                        description: OTP code (returned in development/testing only, not in production)
                        example: "123456"
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  message: Email already exists
                  code: DUPLICATE_EMAIL

  /api/v1/users/verify-otp:
    post:
      summary: Verify email with OTP
      description: |
        Verifies the user's email using the OTP code sent during signup.
        Returns a JWT token upon successful verification which should be used for authenticated requests.
        The token expires in 7 days by default.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: user@example.com
                otp:
                  type: string
                  pattern: '^\d{6}$'
                  description: 6-digit OTP code sent to email
                  example: "123456"
            example:
              email: user@example.com
              otp: "123456"
      responses:
        '200':
          description: Email verified successfully. JWT token returned.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: OTP verified successfully
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: Email verified successfully
                      token:
                        type: string
                        description: JWT authentication token (include in Authorization header for protected routes)
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSIsInJvbGUiOiJkZXNpZ25lciIsImlhdCI6MTczODA1MDAwMCwiZXhwIjoxNzM4NjU0ODAwfQ.abcdef123456
                      user:
                        $ref: '#/components/schemas/User'
        '400':
          description: Invalid OTP or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidOTP:
                  summary: Invalid OTP
                  value:
                    success: false
                    error:
                      message: Invalid OTP
                      code: INVALID_OTP
                expiredOTP:
                  summary: Expired OTP
                  value:
                    success: false
                    error:
                      message: OTP has expired
                      code: OTP_EXPIRED
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/users/resend-otp:
    post:
      summary: Resend OTP code
      description: |
        Generates and sends a new OTP code to the user's email.
        Cannot be used if the email is already verified.
        The new OTP will replace any previously sent OTP.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: user@example.com
            example:
              email: user@example.com
      responses:
        '200':
          description: OTP resent successfully or email already verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: OTP resent successfully
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: New OTP sent to your email
                      otp:
                        type: string
                        description: New OTP code (returned in development for testing)
                        example: "654321"
              examples:
                success:
                  summary: OTP resent successfully
                  value:
                    success: true
                    message: OTP resent successfully
                    data:
                      success: true
                      message: New OTP sent to your email
                      otp: "654321"
                alreadyVerified:
                  summary: Email already verified
                  value:
                    success: true
                    message: OTP resent successfully
                    data:
                      success: false
                      message: Email is already verified
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/users/forgot-password:
    post:
      summary: Request password reset
      description: |
        Sends a password reset email to the user's registered email address.
        The email contains a link with a secure token that expires in 1 hour.
        For security, always returns a success message regardless of whether the email exists.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: User's registered email address
                  example: user@example.com
            example:
              email: user@example.com
      responses:
        '200':
          description: Password reset email sent (or generic success for non-existent emails)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: If an account with that email exists, a password reset link has been sent.
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: If an account with that email exists, a password reset link has been sent.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          description: Failed to send password reset email

  /api/v1/users/reset-password:
    post:
      summary: Reset password with token
      description: |
        Resets the user's password using the token received via email.
        The token is valid for 1 hour from the time it was generated.
        After successful reset, the user can sign in with the new password.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                  description: Password reset token from the email link
                  example: "a1b2c3d4e5f6..."
                newPassword:
                  type: string
                  format: password
                  minLength: 6
                  description: New password (minimum 6 characters)
                  example: newSecurePass123
            example:
              token: "a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2"
              newPassword: newSecurePass123
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Password has been reset successfully. You can now sign in with your new password.
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: Password has been reset successfully. You can now sign in with your new password.
        '400':
          description: Invalid or expired token, or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidToken:
                  summary: Invalid reset token
                  value:
                    success: false
                    error:
                      message: Invalid or expired reset token
                expiredToken:
                  summary: Expired reset token
                  value:
                    success: false
                    error:
                      message: Reset token has expired. Please request a new password reset.